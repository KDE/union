{#
SPDX-License-Identifier: LGPL-2.1-only OR LGPL-3.0-only OR LicenseRef-KDE-Accepted-LGPL
SPDX-FileCopyrightText: 2024 Arjen Hiemstra <ahiemstra@heimr.nl>

This is the template that is used to generate tests for property classes. It uses Jinja 2 syntax.
#}
// SPDX-License-Identifier: LGPL-2.1-only OR LGPL-3.0-only OR LicenseRef-KDE-Accepted-LGPL
//
// This file is automatically generated. To regenerate, run `generate_properties.py`.

#include <QtTest>

#include <properties/{{ type_name }}.h>

#include "CreateTestInstances.h"

using namespace Union::Properties;
using namespace Qt::StringLiterals;

class Test{{ type_name }} : public QObject
{
    Q_OBJECT
private Q_SLOTS:
    void testEmpty()
    {
        {{ type_name }} property;

        // An empty instance should have no values set.
{% for value in values %}
        QVERIFY(!property.{{ value.name }}().has_value());
{% endfor %}
    }

    void testHasAnyValue()
    {
        {{ type_name }} property;

        // An empty instance should not have any values.
        QVERIFY(!property.hasAnyValue());

{% for value in values %}
{% if not value.is_property %}
        {
            {{ value.type }} value;
            property.set{{ value.name | ucfirst }}(value);
            QVERIFY(property.hasAnyValue());
            property.set{{ value.name | ucfirst }}(std::nullopt);
            QVERIFY(!property.hasAnyValue());
        }
{% else %}
        {
            // Assigning an empty property to a value should have no effect.
            property.set{{ value.name | ucfirst }}({{ value.type }}{});
            QVERIFY(!property.hasAnyValue());

            property.set{{ value.name | ucfirst }}(test{{ value.type }}Instance());
            QVERIFY(property.hasAnyValue());

            property.set{{ value.name | ucfirst }}(std::nullopt);
            QVERIFY(!property.hasAnyValue());
        }
{% endif %}
{% endfor %}
    }

    void testResolveProperties()
    {
        {{ type_name }} source;
        {{ type_name }} destination;

        QVERIFY(!source.hasAnyValue());
        QVERIFY(!destination.hasAnyValue());

        // Calling resolve on empty source and destination should have no effect.
        {{ type_name }}::resolveProperties(source, destination);

        QVERIFY(!destination.hasAnyValue());

{% for value in values %}
{% if not value.is_property %}
        source.set{{ value.name | ucfirst }}({{ value.type }}{});
{% else %}
        source.set{{ value.name | ucfirst }}(test{{ value.type }}Instance());
{% endif %}
{% endfor %}

        QVERIFY(source.hasAnyValue());
        QVERIFY(!destination.hasAnyValue());

        {{ type_name }}::resolveProperties(source, destination);

        QVERIFY(destination.hasAnyValue());

{% for value in values %}
        QCOMPARE(destination.{{ value.name }}(), source.{{ value.name }}());
{% endfor %}
    }
};

QTEST_MAIN(Test{{ type_name }})

#include "Test{{ type_name }}.moc"
